<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyclic Peptide Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding: 24px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .header-icon {
            width: 32px;
            height: 32px;
            fill: #4f46e5;
        }
        
        .title {
            font-size: 30px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .subtitle {
            color: #6b7280;
            max-width: 672px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .note {
            font-size: 14px;
            color: #6b7280;
            max-width: 576px;
            margin: 8px auto 0;
        }
        
        .main-content {
            display: flex;
            gap: 24px;
        }
        
        .panel {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 24px;
        }
        
        .panel-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 24px;
        }
        
        .panel-icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        .input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .help-text {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .preset-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            font-size: 12px;
        }
        
        .preset-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 6px;
            text-align: left;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 12px;
        }
        
        .preset-btn-blue {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .preset-btn-blue:hover {
            background: #bfdbfe;
        }
        
        .preset-btn-green {
            background: #dcfce7;
            color: #166534;
        }
        
        .preset-btn-green:hover {
            background: #bbf7d0;
        }
        
        .preset-btn-purple {
            background: #f3e8ff;
            color: #7c3aed;
        }
        
        .preset-btn-purple:hover {
            background: #e9d5ff;
        }
        
        .quick-presets-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .quick-preset-btn {
            padding: 8px 12px;
            background: #f3f4f6;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .quick-preset-btn:hover {
            background: #e5e7eb;
        }
        
        .result-main {
            background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
        }
        
        .result-number {
            font-size: 30px;
            font-weight: bold;
            color: #4f46e5;
            margin-bottom: 8px;
        }
        
        .result-label {
            color: #6b7280;
        }
        
        .result-scientific {
            font-size: 14px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .param-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .param-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        
        .param-value {
            font-size: 24px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .param-label {
            font-size: 14px;
            color: #6b7280;
        }
        
        .info-box {
            background: #fefce8;
            border: 1px solid #fde047;
            border-radius: 8px;
            padding: 16px;
        }
        
        .info-content {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        
        .info-icon {
            width: 20px;
            height: 20px;
            fill: #ca8a04;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .info-text {
            font-size: 14px;
            color: #a16207;
        }
        
        .formula-box {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
        }
        
        .formula-title {
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .formula-text {
            font-size: 14px;
            font-family: 'Courier New', monospace;
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .formula-help {
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
        }
        
        .empty-state {
            text-align: center;
            color: #6b7280;
            padding: 48px 0;
        }
        
        .empty-icon {
            width: 48px;
            height: 48px;
            fill: currentColor;
            opacity: 0.5;
            margin: 0 auto 16px;
        }
        
        .footer {
            margin-top: 32px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 24px;
        }
        
        .footer-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 12px;
        }
        
        .footer-text {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.5;
            margin-bottom: 8px;
        }
        
        .footer-note {
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
        }
        
        .footer-note-text {
            font-size: 12px;
            color: #6b7280;
        }
        
        .space-y-6 > * + * {
            margin-top: 24px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-title">
                <svg class="header-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
                <h1 class="title">Cyclic Peptide Calculator</h1>
            </div>
            <p class="subtitle">
                Calculate the number of unique cyclic peptides based on peptide length and available amino acids using Burnside's lemma for combinatorial analysis.
            </p>
            <p class="note">
                This calculator considers only <strong>classical head-to-tail cyclization</strong> (N-terminus to C-terminus peptide bond formation).
            </p>
        </div>

        <div class="main-content">
            <!-- Parameters Panel -->
            <div class="panel">
                <h2 class="panel-title">
                    <svg class="panel-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 7H6a2 2 0 00-2 2v9a2 2 0 002 2h8a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 1V4a2 2 0 00-2-2H8a2 2 0 00-2 2v3m1 1h4"/>
                    </svg>
                    Parameters
                </h2>

                <!-- Length Input -->
                <div class="form-group">
                    <label class="label">Peptide Length (L)</label>
                    <input type="number" id="length" class="input" min="1" max="50" value="6" placeholder="Enter peptide length">
                    <p class="help-text">Number of amino acid positions in the cycle</p>
                    
                    <!-- Common Cyclic Peptides -->
                    <div style="margin-top: 12px;">
                        <label class="label">Common Cyclic Peptides</label>
                        <div class="preset-grid">
                            <button class="preset-btn preset-btn-blue" onclick="setLength(5)">5 (Small cycles)</button>
                            <button class="preset-btn preset-btn-blue" onclick="setLength(6)">6 (Hexapeptides)</button>
                            <button class="preset-btn preset-btn-blue" onclick="setLength(9)">9 (Oxytocin/Vasopressin)</button>
                            <button class="preset-btn preset-btn-blue" onclick="setLength(10)">10 (Gramicidin S)</button>
                            <button class="preset-btn preset-btn-green" onclick="setLength(11)">11 (Voclosporin*)</button>
                            <button class="preset-btn preset-btn-purple" onclick="setLength(13)">13 (MK-0616†/Daptomycin)</button>
                        </div>
                    </div>
                </div>

                <!-- Unique AA Input -->
                <div class="form-group">
                    <label class="label">Unique Amino Acids (U)</label>
                    <input type="number" id="uniqueAA" class="input" min="1" max="25" value="4" placeholder="Number of unique amino acids">
                    <p class="help-text">Different amino acids available for peptide construction</p>
                </div>

                <!-- Quick Presets -->
                <div class="form-group">
                    <label class="label">Quick Presets</label>
                    <div class="quick-presets-grid">
                        <button class="quick-preset-btn" onclick="setUniqueAA(20)">20 (Standard)</button>
                        <button class="quick-preset-btn" onclick="setUniqueAA(21)">21 (+ Selenocys)</button>
                        <button class="quick-preset-btn" onclick="setUniqueAA(4)">4 (Basic set)</button>
                        <button class="quick-preset-btn" onclick="setUniqueAA(8)">8 (Subset)</button>
                    </div>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="panel">
                <h2 class="panel-title">Results</h2>
                
                <div id="results-content">
                    <div class="empty-state">
                        <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 7H6a2 2 0 00-2 2v9a2 2 0 002 2h8a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 1V4a2 2 0 00-2-2H8a2 2 0 00-2 2v3m1 1h4"/>
                        </svg>
                        <p>Enter valid parameters to see results</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <h3 class="footer-title">About This Calculator</h3>
            <p class="footer-text">
                This calculator uses <strong>Burnside's lemma</strong> to count distinct cyclic arrangements, accounting for rotational symmetry in cyclic peptides.
            </p>
            <p class="footer-text">
                <strong>Rotational symmetry:</strong> Peptides that are identical when rotated are counted as one unique structure.
            </p>
            <div class="footer-note">
                <p class="footer-note-text">
                    <strong>Peptide Status:</strong> *FDA approved, †Merck pipeline (Phase 3). Note: MK-0616 is Merck's leading macrocyclic peptide in development.
                </p>
            </div>
        </div>

        <!-- Interactive Contour Plot -->
        <div class="footer" style="margin-top: 32px;">
            <h3 class="footer-title">Parameter Space Analysis: Interactive Contour Plot</h3>
            <p class="footer-text" style="margin-bottom: 16px;">
                Interactive contour plot showing unique cyclic peptide counts across different peptide lengths (L) and amino acid diversities (U). 
                Contour lines represent equal peptide counts. Hover for exact values, zoom and pan to explore specific regions.
            </p>
            <p class="footer-text" style="margin-bottom: 16px;">
                <strong>Parameters:</strong> Peptide Length (L): 3-20 amino acids, Unique Amino Acids (U): 3-20 types
            </p>
            <div id="plot2d" style="width: 100%; height: 600px; margin-top: 16px;"></div>
        </div>
    </div>

    <script>
        // Calculate Euler's totient function
        function eulerTotient(n) {
            let result = n;
            for (let p = 2; p * p <= n; p++) {
                if (n % p === 0) {
                    while (n % p === 0) n /= p;
                    result -= result / p;
                }
            }
            if (n > 1) result -= result / n;
            return Math.floor(result);
        }

        // Get all divisors of a number
        function getDivisors(n) {
            const divisors = [];
            for (let i = 1; i <= Math.sqrt(n); i++) {
                if (n % i === 0) {
                    divisors.push(i);
                    if (i !== n / i) {
                        divisors.push(n / i);
                    }
                }
            }
            return divisors.sort((a, b) => a - b);
        }

        // Calculate cyclic peptides using Burnside's lemma
        function calculateCyclicPeptides(L, U) {
            if (L <= 0 || U <= 0) return 0;

            const divisors = getDivisors(L);
            let rotationalSum = 0;

            for (const d of divisors) {
                const phi_d = eulerTotient(d);
                const power = L / d;
                rotationalSum += phi_d * Math.pow(U, power);
            }

            const rotationalResult = rotationalSum / L;
            return Math.floor(rotationalResult);
        }

        // Update results
        function updateResults() {
            const length = parseInt(document.getElementById('length').value) || 0;
            const uniqueAA = parseInt(document.getElementById('uniqueAA').value) || 0;
            
            if (length > 0 && uniqueAA > 0) {
                const result = calculateCyclicPeptides(length, uniqueAA);
                
                const resultsHTML = `
                    <div class="space-y-6">
                        <!-- Main Result -->
                        <div class="result-main">
                            <div class="result-number">${result.toLocaleString()}</div>
                            <div class="result-label">Unique Cyclic Peptides</div>
                            ${result > 1000000 ? `<div class="result-scientific">(${result.toExponential(2)})</div>` : ''}
                        </div>

                        <!-- Parameters Summary -->
                        <div class="param-grid">
                            <div class="param-card">
                                <div class="param-value">${length}</div>
                                <div class="param-label">Peptide Length</div>
                            </div>
                            <div class="param-card">
                                <div class="param-value">${uniqueAA}</div>
                                <div class="param-label">Unique Amino Acids</div>
                            </div>
                        </div>

                        <!-- Explanation -->
                        <div class="info-box">
                            <div class="info-content">
                                <svg class="info-icon" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <div class="info-text">
                                    <strong>Calculation Method:</strong>
                                    <p style="margin-top: 4px;">Calculated using Burnside's lemma for rotational symmetry. This considers peptides that look the same when rotated as identical, which is standard for cyclic peptide combinatorial analysis.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Formula Display -->
                        <div class="formula-box">
                            <h3 class="formula-title">Formula Used:</h3>
                            <div class="formula-text">(1/L) × Σ[φ(d) × U^(L/d)] for all divisors d of L</div>
                            <p class="formula-help">where φ(d) is Euler's totient function, L = ${length}, U = ${uniqueAA}</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('results-content').innerHTML = resultsHTML;
            } else {
                document.getElementById('results-content').innerHTML = `
                    <div class="empty-state">
                        <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 7H6a2 2 0 00-2 2v9a2 2 0 002 2h8a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 1V4a2 2 0 00-2-2H8a2 2 0 00-2 2v3m1 1h4"/>
                        </svg>
                        <p>Enter valid parameters to see results</p>
                    </div>
                `;
            }
        }

        // Set length value
        function setLength(value) {
            document.getElementById('length').value = value;
            updateResults();
        }

        // Set unique AA value
        function setUniqueAA(value) {
            document.getElementById('uniqueAA').value = value;
            updateResults();
        }

        // Generate interactive contour plot
        function generate2DPlot() {
            const URange = [];
            const LRange = [];
            const zData = [];
            
            // Generate U values (3 to 20)
            for (let U = 3; U <= 20; U++) {
                URange.push(U);
            }
            
            // Generate L values (3 to 20)
            for (let L = 3; L <= 20; L++) {
                LRange.push(L);
            }
            
            // Calculate peptide counts for all L,U combinations
            for (let i = 0; i < LRange.length; i++) {
                zData[i] = [];
                for (let j = 0; j < URange.length; j++) {
                    const L = LRange[i];
                    const U = URange[j];
                    const peptideCount = calculateCyclicPeptides(L, U);
                    zData[i][j] = peptideCount;
                }
            }
            
            // Create logarithmic contour levels
            const contourLevels = [1, 2, 5, 10, 20, 50, 100, 200, 500, 1000, 
                                 2000, 5000, 10000, 20000, 50000, 100000, 
                                 200000, 500000, 1000000, 2000000, 5000000, 
                                 10000000, 50000000, 100000000, 500000000, 1000000000];
            
            const data = [{
                type: 'contour',
                x: URange,
                y: LRange,
                z: zData,
                colorscale: [
                    [0, '#0f172a'],     // Dark navy
                    [0.1, '#1e3a8a'],   // Dark blue
                    [0.2, '#3b82f6'],   // Blue
                    [0.4, '#06b6d4'],   // Cyan
                    [0.6, '#10b981'],   // Green
                    [0.8, '#f59e0b'],   // Orange
                    [1, '#dc2626']      // Red
                ],
                contours: {
                    start: 1,
                    end: 1000000000,
                    size: 0,  // Auto-calculate
                    showlabels: true,
                    labelfont: {
                        color: 'white',
                        size: 10,
                        family: 'Arial'
                    },
                    labelformat: '.0s'  // Scientific notation (1K, 1M, etc.)
                },
                line: {
                    color: 'white',
                    width: 1,
                    smoothing: 1.3
                },
                colorbar: {
                    title: {
                        text: 'Unique<br>Peptides<br>(log scale)',
                        font: { color: '#374151', size: 11 }
                    },
                    tickfont: { color: '#6b7280', size: 9 },
                    tickmode: 'array',
                    tickvals: [1, 10, 100, 1000, 10000, 100000, 1000000, 10000000, 100000000],
                    ticktext: ['1', '10', '100', '1K', '10K', '100K', '1M', '10M', '100M'],
                    type: 'log',
                    dtick: 1,  // One tick per order of magnitude
                    len: 0.8,  // Make colorbar shorter
                    thickness: 15,  // Make it thinner
                    x: 1.02
                },
                hovertemplate: 
                    '<b>Peptide Length (L)</b>: %{y}<br>' +
                    '<b>Unique Amino Acids (U)</b>: %{x}<br>' +
                    '<b>Unique Peptides</b>: %{z:,.0f}<br>' +
                    '<extra></extra>'
            }];
            
            const layout = {
                title: {
                    text: 'Cyclic Peptide Diversity: Parameter Space Contours',
                    font: { size: 18, color: '#1f2937', family: 'Arial, sans-serif' },
                    x: 0.5
                },
                xaxis: {
                    title: {
                        text: 'Number of Unique Amino Acids (U)',
                        font: { color: '#374151', size: 14 }
                    },
                    tickfont: { color: '#374151', size: 12 },
                    range: [2.5, 20.5],
                    dtick: 2,
                    gridcolor: '#e5e7eb',
                    gridwidth: 1
                },
                yaxis: {
                    title: {
                        text: 'Peptide Length (L)',
                        font: { color: '#374151', size: 14 }
                    },
                    tickfont: { color: '#374151', size: 12 },
                    range: [2.5, 20.5],
                    dtick: 2,
                    gridcolor: '#e5e7eb',
                    gridwidth: 1
                },
                paper_bgcolor: '#ffffff',
                plot_bgcolor: '#f9fafb',
                margin: { l: 80, r: 120, t: 80, b: 80 },
                font: { family: 'Arial, sans-serif' },
                annotations: [
                    {
                        text: 'Each contour line represents<br>equal numbers of unique peptides',
                        x: 0.02,
                        y: 0.98,
                        xref: 'paper',
                        yref: 'paper',
                        xanchor: 'left',
                        yanchor: 'top',
                        showarrow: false,
                        font: {
                            size: 11,
                            color: '#6b7280'
                        },
                        bgcolor: 'rgba(255, 255, 255, 0.8)',
                        bordercolor: '#d1d5db',
                        borderwidth: 1
                    }
                ]
            };
            
            const config = {
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['lasso2d', 'autoScale2d', 'select2d'],
                modeBarButtonsToAdd: [
                    {
                        name: 'Reset View',
                        icon: {
                            width: 857.1,
                            height: 1000,
                            path: 'm214 518h143v196q0 8-5 13t-13 5h-107q-8 0-13-5t-5-13v-196z m357 0h143v196q0 8-5 13t-13 5h-107q-8 0-13-5t-5-13v-196z m-357-232h143v196q0 8-5 13t-13 5h-107q-8 0-13-5t-5-13v-196z m357 0h143v196q0 8-5 13t-13 5h-107q-8 0-13-5t-5-13v-196z'
                        },
                        click: function() {
                            Plotly.relayout('plot2d', {
                                'xaxis.range': [2.5, 20.5],
                                'yaxis.range': [2.5, 20.5]
                            });
                        }
                    }
                ],
                responsive: true
            };
            
            Plotly.newPlot('plot2d', data, layout, config);
        }

        // Add event listeners
        document.getElementById('length').addEventListener('input', updateResults);
        document.getElementById('uniqueAA').addEventListener('input', updateResults);

        // Initial calculation
        updateResults();
        
        // Generate contour plot when page loads
        window.addEventListener('load', function() {
            generate2DPlot();
        });
    </script>
</body>
</html>
